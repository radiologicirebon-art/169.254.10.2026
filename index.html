<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Radiologi RS Mitra Plumbon | Re-Expertise DEVELOP.v2.1</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{background:#eef5ff;font-family:Segoe UI,Arial;font-size:14px}
.card{border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.08)}
.hidden{display:none}
.btn{border-radius:10px}
</style>
</head>

<body class="p-3">

<!-- LOGIN -->
<div id="loginBox" class="card p-4 mx-auto mt-5" style="max-width:380px">
  <h5 class="text-center mb-3">Login Radiologi</h5>
  <input id="username" class="form-control mb-2" placeholder="Username">
  <input id="password" type="password" class="form-control mb-3" placeholder="Password">
  <button class="btn btn-primary w-100" onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="card p-3 mb-3">
  <b>Re-Expertise Radiologi</b><br>
  <small>RS Mitra Plumbon â€¢ DEVELOP.v2.1</small>
</div>

<button class="btn btn-outline-primary mb-3" onclick="openTool()">ðŸ“‹ Monitoring</button>
<button class="btn btn-danger float-end mb-3" onclick="logout()">Logout</button>

<div class="card p-3">
<table class="table table-bordered">
<thead>
<tr>
<th>No</th><th>Nama</th><th>RM</th><th>Unit</th>
<th>Status</th><th>Komentar</th><th>Aksi (ADMIN)</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>
</div>

</div>

<script>
const DB="https://develop-re-expertise2026-default-rtdb.asia-southeast1.firebasedatabase.app";
let ROLE="USER";

/* LOGIN */
function login(){
  ROLE=(username.value==="admin"&&password.value==="admin")?"ADMIN":"USER";
  localStorage.setItem("role",ROLE);
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");
}
if(localStorage.getItem("role")){
  ROLE=localStorage.getItem("role");
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");
}
function logout(){localStorage.clear();location.reload()}

/* LOAD DATA */
function load(){
fetch(DB+"/permohonan.json").then(r=>r.json()).then(d=>{
let h="",n=1;if(!d)return;
for(let k in d){
let x=d[k];
h+=`
<tr>
<td>${n++}</td>
<td>${x.nama}</td>
<td>${x.rm}</td>
<td>${x.ranap||"-"}</td>
<td><b>${x.status}</b></td>
<td>${x.komentar||"-"}</td>
<td>
${ROLE==="ADMIN"
?`
<button class="btn btn-sm btn-secondary" onclick="toggleAksi('${k}')">Aksi</button>
<div id="aksi-${k}" class="hidden mt-2">
  <button class="btn btn-sm btn-warning mb-1" onclick="setStatus('${k}','DIPROSES')">Proses</button>
  <button class="btn btn-sm btn-success mb-1" onclick="setStatus('${k}','SELESAI')">Selesai</button>
  <input id="kom-${k}" class="form-control form-control-sm mb-1" placeholder="Komentar..." value="${x.komentar||""}">
  <button class="btn btn-sm btn-info" onclick="saveKomentar('${k}')">Simpan</button>
</div>
`
:"-"}
</td>
</tr>`;
}
data.innerHTML=h;
});
setTimeout(load,3000);
}
load();

/* ACTION */
function toggleAksi(id){
document.querySelectorAll("[id^='aksi-']").forEach(x=>x.classList.add("hidden"));
document.getElementById("aksi-"+id).classList.toggle("hidden");
}
function setStatus(id,s){
fetch(DB+"/permohonan/"+id+".json",{method:"PATCH",
body:JSON.stringify({status:s})});
}
function saveKomentar(id){
let v=document.getElementById("kom-"+id).value;
fetch(DB+"/permohonan/"+id+".json",{method:"PATCH",
body:JSON.stringify({komentar:v})});
}
</script>

</body>
</html>
